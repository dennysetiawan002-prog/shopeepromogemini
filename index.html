<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menghubungkan ke Promo...</title>
    
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "0753009f-ff36-4368-8ee3-ba6b777f91e0",
    });
  });
</script>
  
<script>
        // --- KONFIGURASI ---
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby2MsMX7cHE9N2K_rGwwujIXk1pyoTpBMgB5lyFLNh0tn2nOU8DwM9hrdUUIKdGlJ4OJg/exec";
        const TELEGRAM_BOT_USERNAME = "Shopee_HunterPromo_bot"; 
        
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id') || "home"; 
        
        // Link Affiliate Shopee
        const shopeeAffiliateLink = "https://s.shopee.co.id/8APz5wE4RP";

        function startProcess() {
            // 1. TANAM COOKIE DIAM-DIAM
            var img = new Image();
            img.src = shopeeAffiliateLink;

            // 2. KIRIM DATA KE GOOGLE SHEETS
            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({
                    user_id: "GUEST_" + Date.now(),
                    platform: "Web_Entry",
                    name: "Visitor",
                    location: "Detecting..."
                })
            });

            // 3. TRIGGER IZIN NOTIFIKASI (Jika user tidak punya Telegram)
            // Ini akan memunculkan pop-up "Izinkan Notifikasi"
            if (window.OneSignalDeferred) {
                OneSignalDeferred.push(function(OneSignal) {
                    OneSignal.Notifications.requestPermission();
                });
            }

            // 4. PINTU OTOMATIS: CEK TELEGRAM
            var start = Date.now();
            window.location.href = "tg://resolve?domain=" + TELEGRAM_BOT_USERNAME;

            // 5. FALLBACK
            setTimeout(function() {
                if (Date.now() - start < 2500) {
                    window.location.href = shopeeAffiliateLink;
                }
            }, 2000);
        }

        window.onload = startProcess;
    </script>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background: #f4f4f4; }
        .loader { text-align: center; }
    </style>
</head>
<body>
    <div class="loader">
        <p>Mohon tunggu sebentar...</p>
        <small>Sedang menyiapkan promo terbaik untukmu</small>
    </div>
</body>
</html>
